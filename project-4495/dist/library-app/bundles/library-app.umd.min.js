!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs"),require("@angular/core"),require("lodash"),require("rxjs/operators"),require("@angular/common/http"),require("@angular/fire/firestore")):"function"==typeof define&&define.amd?define("library-app",["exports","rxjs","@angular/core","lodash","rxjs/operators","@angular/common/http","@angular/fire/firestore"],e):e((t=t||self)["library-app"]={},t.rxjs,t.ng.core,t.lodash,t.rxjs.operators,t.ng.common.http,t.ng.fire.firestore)}(this,(function(t,e,n,r,o,i,a){"use strict";r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r;
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var u=function(t,e){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function s(t,e){function n(){this.constructor=t}u(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var c;function l(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var u=t.length-1;u>=0;u--)(o=t[u])&&(a=(i<3?o(a):i>3?o(e,n,a):o(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a}function f(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(t){i(t)}}function u(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,u)}s((r=r.apply(t,e||[])).next())}))}function p(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}}function h(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}(c=t.ENUM_TABLES||(t.ENUM_TABLES={})).customer="customer",c.restaurant="restaurant",c.meal="meal",c.courier="courier",c.order_item="order_item",c.order="order";var d,m=function(){function t(){this.unsubscribeAll()}return t.prototype.ngOnDestroy=function(){this.unsubscribeAll()},t.prototype.unsubscribeAll=function(){this._subscriptionList&&this._subscriptionList.unsubscribe(),this._subscriptionList=new e.Subscription},t.prototype.addSubscribes=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];e.forEach((function(e){t._subscriptionList.add(e)}))},t}(),v=function(){function t(t){t.hasOwnProperty("_raw")&&delete t._raw,this._raw=t}return t.prototype.copyInto=function(t){for(var e in t)this.hasOwnProperty(e)&&(this[e]=t[e])},t.prototype.getData=function(){var e=this,n={};return Object.keys(this).map((function(r){if(!(e[r]instanceof t)){switch(r){case"_raw":case"meals":case"items":return}n[r]=e[r]}})),n},t}(),y=function(t){function e(e){var n=t.call(this,e)||this;return n.id="",n.name="",n.vin="",n.driver_license="",n.email="",n.phone_no="",t.prototype.copyInto.call(n,e),n}return s(e,t),e}(v),_=function(t){function e(e){var n=t.call(this,e)||this;return n.id="",n.name="",n.address="",n.lat="",n.long="",n.phone_no="",n.email="",t.prototype.copyInto.call(n,e),n}return s(e,t),e}(v),b=function(){},g=function(t){function e(e){var n=t.call(this,e)||this;return n.id="",n.name="",n.description="",n.price=0,n.image="",n.restaurant_name="",t.prototype.copyInto.call(n,e),n}return s(e,t),e}(v),S=function(t){function e(e){var n=t.call(this,e)||this;return n.id="",n.date_time=0,n.restaurant_id="",n.customer_id="",n.total=0,t.prototype.copyInto.call(n,e),n}return s(e,t),e}(v),E=function(t){function e(e){var n=t.call(this,e)||this;return n.id="",n.order_id="",n.meal_id="",n.quantity=0,t.prototype.copyInto.call(n,e),n}return s(e,t),e}(v),A=function(){},T=function(){},B=function(){},L=function(t){function e(e){var n=t.call(this,e)||this;return n.id="",n.name="",n.address="",n.phone_no="",n.lat="",n.long="",n.meal_ids=[],n.meals=[],t.prototype.copyInto.call(n,e),n}return s(e,t),e}(v);!function(t){t.LESS="<",t.LESS_EQUAL="<=",t.EQUAL="==",t.GREATER=">",t.GREATER_EQUAL=">="}(d||(d={}));var M=function(){function t(t,e,n){this.key=t,this.operation=e,this.value=n}return t.OPERATIONS=d,t}(),w=function(){function t(t){this._HttpClient=t}return t.prototype.getJSON=function(t){return this._HttpClient.get(t)},t.ctorParameters=function(){return[{type:i.HttpClient}]},t.ɵprov=n.ɵɵdefineInjectable({factory:function(){return new t(n.ɵɵinject(i.HttpClient))},token:t,providedIn:"root"}),t=l([n.Injectable({providedIn:"root"})],t)}(),N=function(){function e(e){var n;this._UtilsService=e,this.CONSTANT_PATH="assets/dummy/",this.JSONS=((n={})[t.ENUM_TABLES.restaurant]="restaurant.json",n[t.ENUM_TABLES.customer]="customer.json",n[t.ENUM_TABLES.meal]="meal.json",n[t.ENUM_TABLES.courier]="courier.json",n)}return e.prototype.convertDummyDataToModel=function(t,e){return this.JSONS[t]?this._UtilsService.getJSON(this.CONSTANT_PATH+this.JSONS[t]).pipe(o.tap(),o.first()).toPromise().then((function(t){var n=[];return r.map(t,(function(t){var r=new e(t);n.push(r)})),n})):Promise.resolve([])},e.TABLES=t.ENUM_TABLES,e.ctorParameters=function(){return[{type:w}]},e.ɵprov=n.ɵɵdefineInjectable({factory:function(){return new e(n.ɵɵinject(w))},token:e,providedIn:"root"}),e=l([n.Injectable({providedIn:"root"})],e)}(),j=function(){function t(){this._Observable_Message=new e.BehaviorSubject(null)}return t.prototype.reset=function(){this._Observable_Message.next(null)},t.prototype.pushMessage=function(t){this._Observable_Message.next(t)},t.prototype.getMessageOservable=function(){return this._Observable_Message},t.ɵprov=n.ɵɵdefineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t=l([n.Injectable({providedIn:"root"})],t)}(),D=function(){function e(e,n,r){var o;this._AngularFirestore=e,this._DummyDataService=n,this._NotificationService=r,this.TABLES=((o={})[t.ENUM_TABLES.customer]={name:t.ENUM_TABLES.customer,class:_},o[t.ENUM_TABLES.courier]={name:t.ENUM_TABLES.courier,class:y},o[t.ENUM_TABLES.restaurant]={name:t.ENUM_TABLES.restaurant,class:L},o[t.ENUM_TABLES.meal]={name:t.ENUM_TABLES.meal,class:g},o[t.ENUM_TABLES.order]={name:t.ENUM_TABLES.order,class:S},o[t.ENUM_TABLES.order_item]={name:t.ENUM_TABLES.order_item,class:E},o)}return e.prototype.resetDB=function(){return f(this,void 0,void 0,(function(){var t=this;return p(this,(function(e){switch(e.label){case 0:return[4,Promise.all(r.map(this.TABLES,(function(e){return f(t,void 0,void 0,(function(){return p(this,(function(t){switch(t.label){case 0:return[4,this.deleteDB(e.name)];case 1:return t.sent(),[2]}}))}))})))];case 1:return e.sent(),[4,Promise.all(r.map(this.TABLES,(function(e){return f(t,void 0,void 0,(function(){return p(this,(function(t){switch(t.label){case 0:return[4,this.addDB(e)];case 1:return t.sent(),[2]}}))}))})))];case 2:return e.sent(),[4,this.linkRestaurantMealDB()];case 3:return e.sent(),this._NotificationService.pushMessage("All data is reset!!"),[2]}}))}))},e.prototype.linkRestaurantMealDB=function(){return f(this,void 0,void 0,(function(){var e=this;return p(this,(function(n){switch(n.label){case 0:return this._NotificationService.pushMessage("Link Restaurant & Meal data"),[4,this.getRestaurant().then((function(n){e.getMeals().then((function(o){r.map(n,(function(n){n.meal_ids=r.map(r.filter(o,(function(t){return n.name===t.restaurant_name})),(function(t){return t.id})),e._AngularFirestore.collection(e.TABLES[t.ENUM_TABLES.restaurant].name).doc(n.id).set(n.getData())}))}))}))];case 1:return n.sent(),[2]}}))}))},e.prototype.deleteDB=function(t){var e=this;return this._AngularFirestore.collection(t).get().toPromise().then((function(n){return n.forEach((function(n){return f(e,void 0,void 0,(function(){return p(this,(function(e){switch(e.label){case 0:return[4,n.ref.delete()];case 1:return e.sent(),console.log("delete "+t),this._NotificationService.pushMessage("delete "+t),[2]}}))}))}))}))},e.prototype.addDB=function(t){var e=this;return this._DummyDataService.convertDummyDataToModel(t.name,t.class).then((function(n){return f(e,void 0,void 0,(function(){var e,o=this;return p(this,(function(i){switch(i.label){case 0:return n?(e=this._AngularFirestore.collection(t.name),[4,Promise.all(r.map(n,(function(n){return f(o,void 0,void 0,(function(){return p(this,(function(r){switch(r.label){case 0:return[4,e.add(n.getData())];case 1:return r.sent(),console.log("add "+t.name),this._NotificationService.pushMessage("add "+t.name),[2]}}))}))})))]):[2];case 1:return[2,i.sent()]}}))}))}))},e.prototype.getCustomer=function(){return this.getDB(this.TABLES[t.ENUM_TABLES.customer]).then((function(t){return t}))},e.prototype.getCourier=function(){return this.getDB(this.TABLES[t.ENUM_TABLES.courier]).then((function(t){return t}))},e.prototype.getRestaurant=function(){var e=this;return this.getDB(this.TABLES[t.ENUM_TABLES.restaurant]).then((function(t){return e.getMeals().then((function(e){return r.map(t,(function(t){t.meals=r.filter(e,(function(e){return t.meal_ids.indexOf(e.id)>=0}))})),t}))}))},e.prototype.getMeals=function(){return this.getDB(this.TABLES[t.ENUM_TABLES.meal]).then((function(t){return t}))},e.prototype.getOrderItems=function(e){return f(this,void 0,void 0,(function(){var n=this;return p(this,(function(o){return[2,this.getDB(this.TABLES[t.ENUM_TABLES.order_item],e).then((function(t){return t})).then((function(e){return r.map(e,(function(e){return f(n,void 0,void 0,(function(){return p(this,(function(n){switch(n.label){case 0:return[4,this.getDBWithId(this.TABLES[t.ENUM_TABLES.meal],e.meal_id).then((function(t){e.meal=t}))];case 1:return n.sent(),[2]}}))}))})),e}))]}))}))},e.prototype.getOrder=function(){return f(this,void 0,void 0,(function(){var e=this;return p(this,(function(n){return[2,this.getDB(this.TABLES[t.ENUM_TABLES.order]).then((function(t){return t})).then((function(n){return n=n,r.map(n,(function(n){return f(e,void 0,void 0,(function(){return p(this,(function(e){switch(e.label){case 0:return[4,this.getDBWithId(this.TABLES[t.ENUM_TABLES.customer],n.customer_id).then((function(t){n.customer=t}))];case 1:return e.sent(),[4,this.getOrderItems([new M("order_id",M.OPERATIONS.EQUAL,n.id)]).then((function(t){n.items=t}))];case 2:return e.sent(),[4,this.getDBWithId(this.TABLES[t.ENUM_TABLES.restaurant],n.restaurant_id).then((function(t){n.restaurant=t}))];case 3:return e.sent(),[2]}}))}))})),n}))]}))}))},e.prototype.getDB=function(t,e,n){var i=this;return this._AngularFirestore.collection(t.name,(function(t){var n=null;return e&&r.map(e,(function(e){n=n?n.where(e.key,e.operation,e.value):t.where(e.key,e.operation,e.value)})),n||t})).snapshotChanges().pipe(o.map((function(t){return t.map((function(t){var e=t.payload.doc.data(),n=t.payload.doc.id;return e.id=n,e}))})),o.map((function(t){return r.filter(t,(function(t){return n?t.id===n:t}))}))).pipe(o.tap(),o.first()).toPromise().then((function(e){return i.convertToClassObject(e,t.class)}))},e.prototype.getDBWithId=function(t,e){var n=this;return this._AngularFirestore.doc(t.name+"/"+e).snapshotChanges().pipe(o.map((function(t){var e=t.payload.data(),n=t.payload.id;return e.id=n,e}))).pipe(o.tap(),o.first()).toPromise().then((function(e){var r=n.convertToClassObject([e],t.class);return r.length?r[0]:null}))},e.prototype.convertToClassObject=function(t,e){var n=[];return r.map(t,(function(t){var r=new e(t);n.push(r)})),n},e.prototype.createWithObject=function(t){var e=this._AngularFirestore.createId();return this._AngularFirestore.collection(this.getTable(t.constructor.name)).doc(e).set(t.getData()).then((function(){t.id=e}))},e.prototype.updateWithObject=function(t){this._AngularFirestore.collection(this.getTable(t.constructor.name)).doc(t.id).update(t.getData())},e.prototype.getTable=function(t){return r.find(this.TABLES,(function(e){return e.class.name===t})).name},e.ctorParameters=function(){return[{type:a.AngularFirestore},{type:N},{type:j}]},e.ɵprov=n.ɵɵdefineInjectable({factory:function(){return new e(n.ɵɵinject(a.AngularFirestore),n.ɵɵinject(N),n.ɵɵinject(j))},token:e,providedIn:"root"}),e=l([n.Injectable({providedIn:"root"})],e)}(),O=function(){function t(t){this._FirebaseDataService=t}return t.prototype.start=function(){return f(this,void 0,void 0,(function(){var t=this;return p(this,(function(e){return Promise.all([this._FirebaseDataService.getCustomer(),this._FirebaseDataService.getRestaurant()]).then((function(e){var n=h(e,2),r=n[0],o=n[1];return f(t,void 0,void 0,(function(){var t,e,n,i,a;return p(this,(function(u){switch(u.label){case 0:return console.log(r,o),t=this.getRandom(r),e=this.getRandom(o),n=this.getRandom(e.meals),console.log(t,e,n),console.log(t instanceof v),i=new S({date_time:(new Date).getTime(),restaurant_id:e.id,customer_id:t.id}),[4,this._FirebaseDataService.createWithObject(i)];case 1:return u.sent(),(a=new E({meal_id:n.id,quantity:this.getRandom(5),order_id:i.id})).meal=n,a.order=i,[4,this._FirebaseDataService.createWithObject(a)];case 2:return u.sent(),i.total+=a.meal.price*a.quantity,this._FirebaseDataService.updateWithObject(i),[2]}}))}))})),[2]}))}))},t.prototype.stop=function(){},t.prototype.getRandom=function(t){return isNaN(Number(t))?(t=t)[r.random(0,t.length-1)]:r.random(0,t)},t.ctorParameters=function(){return[{type:D}]},t.ɵprov=n.ɵɵdefineInjectable({factory:function(){return new t(n.ɵɵinject(D))},token:t,providedIn:"root"}),t=l([n.Injectable({providedIn:"root"})],t)}(),I=function(){function t(){}return t.prototype.testString=function(){return"Hello"},t.ɵprov=n.ɵɵdefineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t=l([n.Injectable({providedIn:"root"})],t)}(),U=function(){function t(){}return t.prototype.ngOnInit=function(){},t=l([n.Component({selector:"lib-library-app",template:"\n    <p>\n      library-app works!\n    </p>\n  "})],t)}(),P=function(){function t(){}return t=l([n.NgModule({declarations:[U],imports:[],exports:[U]})],t)}(),R=function(){function t(){}return t.prototype.testString=function(){return"Hello Test App"},t.ɵprov=n.ɵɵdefineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t=l([n.Injectable({providedIn:"root"})],t)}();t.Courier=y,t.Customer=_,t.DefaultComponent=m,t.DefaultModel=v,t.Delivery=b,t.DummyDataService=N,t.FirebaseDataService=D,t.LibraryAppComponent=U,t.LibraryAppModule=P,t.LibraryAppService=I,t.Meal=g,t.NotificationService=j,t.Order=S,t.OrderItem=E,t.OrderStatusHistory=A,t.OrderStatusType=T,t.Point=B,t.QueryParamModel=M,t.Restaurant=L,t.SimulatorDataService=O,t.TestAppService=R,t.UtilsService=w,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=library-app.umd.min.js.map